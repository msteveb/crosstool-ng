From 4642974486686ef2e5bea7ca3bd51faef3b55e2e Mon Sep 17 00:00:00 2001
From: Steve Bennett <steveb@workware.net.au>
Date: Fri, 3 Apr 2020 09:23:30 +1000
Subject: [PATCH] support system without tkill

Use pthread_kill(pthread_self(), sig) to implement raise
---
 libpthread/linuxthreads/signals.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/libpthread/linuxthreads/signals.c b/libpthread/linuxthreads/signals.c
index 0c0f2b6b1..6d077cfe1 100644
--- a/libpthread/linuxthreads/signals.c
+++ b/libpthread/linuxthreads/signals.c
@@ -238,8 +238,16 @@ int raise (int sig) {
   int ret;
   pid_t tid;
 
+#ifdef __NR_tkill
   tid = INLINE_SYSCALL(gettid, 0);
   ret = INLINE_SYSCALL(tkill, 2, tid, sig);
+#else
+  ret = pthread_kill(pthread_self(), sig);
+  if (ret) {
+    errno = ret;
+    ret = -1;
+  }
+#endif
 
   return ret;
 }
-- 
2.17.1

